function _typeof(a){if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("theme_charteredcollege/section_asset_management",["jquery","core/log","core/ajax","core/str","core/templates","core/notification","theme_charteredcollege/util","theme_charteredcollege/ajax_notification","theme_charteredcollege/footer_alert","core/event","core/fragment"],function(a,b,c,d,e,f,g,h,i,j,k){var l=this,m=[],n,o=!1,p,q=[],r=null,s=null,t=function(){if("weeks"==l.courseConfig.format||"topics"==l.courseConfig.format){a("#course-toc .chapter-title").click(function(b){var c=a(b.target),d=c.attr("href");if("undefined"!=typeof d&&0<d.length){y(d.split("#section-")[1],0)}});a("#toc-searchables li a").click(function(b){var c=a(b.target),d=c.attr("href").split("&"),e=d[0],f=d[1]||null;e=e.split("#section-")[1];y(e,f)})}},u=function(){if("weeks"==l.courseConfig.format||"topics"==l.courseConfig.format){a(".section_footer .next_section, .section_footer .icon-arrow-right, .section_footer .previous_section, .section_footer .icon-arrow-left").click(function(b){var c=a(b.target),d=c.attr("section-number");if("undefined"!=typeof d&&0<d.length){y(d,0)}});a(".section_footer .text").click(function(b){var c=a(b.target),d=c.find(".nav_guide").attr("section-number");if("undefined"!=typeof d&&0<d.length){y(d,0)}})}},v=function(b){a("#toc-search-results").html("");var c=a("#"+b.replace("#",""));g.scrollToElement(c);var d=a("#searchpin");if(!d.length){d=a("<i id=\"searchpin\"></i>")}a(c).find(".instancename").prepend(d);a(c).attr("tabindex","-1").focus();a("#course-toc").removeClass("state-visible")},w=function(){var b;if(1===m.length){var c=a(m[0]).find(".charteredcollege-asset-link .instancename").html();c=c||M.util.get_string("pluginname","label",c);b=M.util.get_string("moving","theme_charteredcollege",c)}else{b=M.util.get_string("movingcount","theme_charteredcollege",m.length)}i.setTitle(b)},x=function(b){if("undefined"!=typeof m&&0<m.length){a(".section-drop").each(function(){var c=M.util.get_string("movingdropsectionhelp","theme_charteredcollege",{moving:b,before:a(this).data("title")});a(this).html(c)});i.setSrNotice(M.util.get_string("movingstartedhelp","theme_charteredcollege",b))}},y=function(b,c){var d=a("#section-"+b);if(0==d.length&&-1==q.indexOf(b)){q.push(b);var e={courseid:l.courseConfig.id,section:b};a(".sk-fading-circle").show();a(".course-content ."+l.courseConfig.format+" li[id^=\"section-\"]").hide();k.loadFragment("theme_charteredcollege","section",l.courseConfig.contextid,e).done(function(d,e){var f=a(d);z(b,f,c,e);var g=f.find("li.charteredcollege-activity.modtype_folder");a.each(g,function(b,c){var d=a(c).find("div.contentwithoutlink div.charteredcollege-assettype");if(0<d.length){if(0==a(c).find("div.activityinstance div.charteredcollege-header-card .asset-type").length){var e=a(c).find("div.activityinstance div.charteredcollege-header-card");d.prependTo(e)}}});a("#section-"+b+" li.charteredcollege-activity.modtype_folder div[id^=\"folder_tree\"] > ul > li > div > span.fp-filename").each(function(){a(this).replaceWith("<h3>"+a(this).text()+"</h3>")})})}},z=function(b,c,d,f){var g=a(".course-content ."+l.courseConfig.format),h=[];g.find("li[id^=section-]").each(function(){h.push(parseInt(a(this).attr("id").split("section-")[1]))});var i=a("<div></div>");e.replaceNodeContents(i,c,"");i.find(".charteredcollege-resource-long .contentafterlink .charteredcollege-resource-card-fadeout").each(function(){a(this).appendTo(a(this).prevAll(".charteredcollege-resource-long .contentafterlink .no-overflow"))});i.find(".charteredcollege-header-card .charteredcollege-header-card-icons .disabled-charteredcollege-asset-completion-tracking").remove();if(0<h.length){var k=h.reduce(function(a,c){return Math.abs(c-b)<Math.abs(a-b)?c:a});if(k>b){g.find("#section-"+k).before(i.find("li[id^=\"section-\"]"))}else{g.find("#section-"+k).after(i.find("li[id^=\"section-\"]"))}}else{a(".sk-fading-circle").after(i)}e.runTemplateJS(f);a(".sk-fading-circle").hide();j.notifyFilterContentUpdated(a(".course-content ."+l.courseConfig.format));var m=g.find("li[id^=\"section-\"]");m.removeClass("state-visible");var n="#section-"+b;a(n).addClass("state-visible");if("top"==l.courseConfig.toctype&&"topics"==l.courseConfig.format&&0<b){var o=a(n).find(".sectionname").html(),p=a(".chapter-title"),q=0;a.each(p,function(c,d){if(a(d).attr("href").split("#section-")[1]==b){q=c}});a(n).find(".sectionname").html(o);a(n).find(".sectionnumber").html(q+".")}m.show();a(n).find(".section_footer .next_section, .section_footer .icon-arrow-right, .section_footer .previous_section, .section_footer .icon-arrow-left").click(function(b){var c=a(b.target),d=c.attr("section-number");if("undefined"!=typeof d&&0<d.length){y(d,0)}});a(n).find(".section_footer .text").click(function(b){var c=a(b.target),d=c.find(".nav_guide").attr("section-number");if("undefined"!=typeof d&&0<d.length){y(d,0)}});a(n+" .section-modchooser-link").click(function(){var b=a(this).attr("data-section");a(".charteredcollege-modchooser-addlink").each(function(){var c=this.href.replace(/(section=)[0-9]+/ig,"$1"+b);a(this).attr("href",c)})});if(0!=d&&"undefined"!=typeof d){v(d)}var r=a("#region-main .section-moving").find(".sectionname").text();if("undefined"!=typeof r&&0<r.length){x(r)}var s=a("#region-main .section-moving").attr("id");if("undefined"!=typeof s&&0<s.length){a("#section-"+(parseInt(s.split("section-")[1])+1)+" .charteredcollege-drop.section-drop").removeClass("partial-render")}a("#course-toc #chapters li").removeClass("charteredcollege-visible-section");a("#course-toc .chapter-title[href=\"#section-"+b+"\"]").parent("li").addClass("charteredcollege-visible-section");a(n).find("ul.section").append("<li class=\"charteredcollege-drop asset-drop\"><div class=\"asset-wrapper\"><a href=\"#\">"+M.util.get_string("movehere","theme_charteredcollege")+"</a></div></li>")};return{init:function init(j){l.courseConfig=j.courseConfig;p=new function AjaxTracker(){var c={};this.start=function(d,e,f){if(this.ajaxing(d)){b.debug("Skipping ajax request for "+d+", AJAX already in progress");return!1}M.util.js_pending(d);c[d]={trigger:e,subSelector:f};if(e){if(f){a(e).find(f).addClass("ajaxing")}else{a(e).addClass("ajaxing")}}return!0};this.ajaxing=function(a){return-1<M.util.pending_js.indexOf(a)};this.complete=function(b){var d,e;if(c[b]){d=c[b].trigger;e=c[b].subSelector}if(d){if(e){a(d).find(e).removeClass("ajaxing")}else{a(d).removeClass("ajaxing")}}delete c[b];M.util.js_complete(b)}};var k=function(b){if(l.courseConfig.partialrender){return parseInt(a(b).attr("id").split("section-")[1])}else{return parseInt(a(b).attr("id").replace("section-",""))}},v=function(b){return k(a(b).parents("li.section.main")[0])},z=function(){a("body").removeClass("charteredcollege-move-inprogress");a("body").removeClass("charteredcollege-move-section");a("body").removeClass("charteredcollege-move-asset");i.hideAndReset();a(".section-moving").removeClass("section-moving");a(".asset-moving").removeClass("asset-moving");a(".charteredcollege-asset a").removeAttr("tabindex");a(".charteredcollege-asset button").removeAttr("disabled");a(".js-charteredcollege-asset-move").removeAttr("checked");m=[];if(l.courseConfig.partialrender){a(".charteredcollege-drop.section-drop").addClass("partial-render")}},A=function(){var b=a(n).find(".instancename").html();i.removeAjaxLoading();i.setTitle(M.util.get_string("movefailed","theme_charteredcollege",b));window.setTimeout(function(){z(!1)},2e3)},B=function(a){var b=m.indexOf(a);if(-1<b){m.splice(b,1)}w()},C=function(c,d,e){if(o){b.debug("Skipping ajax request, one already in progress");return}i.addAjaxLoading();c.sesskey=M.cfg.sesskey;c.courseId=j.courseConfig.id;c.field="move";b.debug("Making course/rest.php request",c);var f=a.ajax({type:"POST",async:!0,data:c,url:M.cfg.wwwroot+j.courseConfig.ajaxurl});f.done(function(a){h.ifErrorShowBestMsg(a).done(function(a){if(a){b.debug("Ajax request fail");A()}else{b.debug("Ajax request successful");if(d){d()}if(e){if("resource"===c.class){z()}}}})});f.fail(function(){A()});if(e){f.always(function(){o=!1;i.removeAjaxLoading()})}},D=function(b){if(l.courseConfig.partialrender){return a("#course-toc #chapters > li a[href=\"#section-"+b+"\"]").text()}else{return a("#chapters li:nth-of-type("+(b+1)+") .chapter-title").html()}},E=function(b){var c=a.Deferred(),d,f;if(!b){if(l.courseConfig.partialrender){b="#course-toc #chapters > li a"}else{b="#region-main .course-content > ul li.section"}d=a(b);f=d.length}else{d=a(b);if(l.courseConfig.partialrender){var g=a("#course-toc #chapters > li a")}else{var g=a("#region-main .course-content > ul li.section")}f=g.length}var h=0;a.each(d,function(b,g){if(l.courseConfig.partialrender){var i=a(g).attr("href"),j;if(_typeof(i)!=="undefined"&&!1!==i){j=parseInt(a(g).attr("href").split("#section-")[1])}else{j=parseInt(a(g).attr("id").split("section-")[1])}}else{var j=k(g)}var m=j-1,n=j+1,o=!1,p=!1,q,r;if(-1<m){if(l.courseConfig.partialrender){q=a("#section-"+m).hasClass("draft")}else{q=a("#section-"+m).hasClass("hidden")}r=q?" dimmed_text":"";o={section:m,title:D(m),classes:r}}if(n<f){if(l.courseConfig.partialrender){q=a("#section-"+n).hasClass("draft")}else{q=a("#section-"+n).hasClass("hidden")}r=q?" dimmed_text":"";p={section:n,title:D(n),classes:r}}var s={previous:o,next:p};e.render("theme_charteredcollege/course_section_navigation",s).done(function(b){var e=a("#section-"+j+" .section_footer");if(0<e.length){e.replaceWith(b)}h++;if(h===d.length){c.resolve()}})});return c.promise()},F=function(a,b,c){if(c>=a.length){var d=c-a.length+1;while(d--){a.push(void 0)}}a.splice(c,0,a.splice(b,1)[0]);return a},G=function(b,c,d,e){if(j.courseConfig.partialrender){var f=[],g=[];if(0!=b&&0!=c){a.each(a("#course-toc #chapters > li a"),function(b,c){g.push(a(c).attr("href").split("#section-")[1])});var h=F(g,b,c)}else{g=d;d.splice(e,1);var h=d}a.each(a("#region-main .course-content > ul li.section"),function(b,c){var d=a(c).attr("id").split("section-")[1],e=h.indexOf(d),g=D(e),i=g;a(c).attr("id","section-"+e);if("top"==l.courseConfig.toctype&&"topics"==l.courseConfig.format&&0<e){i="<span class='sectionnumber'> ".concat(e,".</span>").concat(g)}a("#section-"+e+" .content .sectionname").html(i);f.push(e);a(c).find("a.section-modchooser-link").attr("data-section",e)});q=f}else{a.each(a("#region-main .course-content > ul li.section"),function(b,c){a(c).attr("id","section-"+b);var d=D(b),e=d;if("top"==l.courseConfig.toctype&&"topics"==l.courseConfig.format&&0<b){e="<span class='sectionnumber'></span>".concat(d)}a("#section-"+b+" .content .sectionname").html(e);a(this).find("a.section-modchooser-link").attr("data-section",b)})}E().done(function(){if(j.courseConfig.partialrender){W()}})},H=function(d,g){d.preventDefault();var k=v(g),m=a("#section-"+k),n=m.find(".sectionname").text(),o=function(){if(!p.start("section_delete",g)){return}var d=M.util.get_string("deletingsection","theme_charteredcollege",n);i.addAjaxLoading("");i.show();i.setTitle(d);var f={courseshortname:j.courseConfig.shortname,action:"delete",sectionnumber:k,value:1,loadmodules:!0};b.debug("Making course/rest.php section delete request",f);var o=c.call([{methodname:"theme_charteredcollege_course_sections",args:f}],!0,!0),q=[];a.each(a("#course-toc #chapters > li a"),function(b,c){q.push(a(c).attr("href").split("#section-")[1])});o[0].done(function(b){e.render("theme_charteredcollege/course_toc",b.toc).done(function(b){a("#course-toc").html(a(b).html());a(document).trigger("charteredcollegeTOCReplaced");m.remove();G(0,0,q,k);if(l.courseConfig.partialrender){var c=a(".chapter-title"),d=[];a.each(c,function(b,c){d.push(a(c).attr("href").split("#section-")[1])});var e=d.reduce(function(a,b){return Math.abs(b-k)<Math.abs(a-k)?b:a});location.hash="section-"+e;if(1==a("li#section-"+e).length){j.showSection()}else{y(e,0)}}else{if(k>=a(".course-content > ul li.section").length){location.hash="section-"+(k-1)}j.showSection()}p.complete("section_delete")}).always(function(){i.hideAndReset()}).fail(function(){p.complete("section_delete")})}).fail(function(a){h.ifErrorShowBestMsg(a);i.hideAndReset();p.complete("section_delete")})},q=M.util.get_string("confirm","moodle"),r=M.util.get_string("confirmdeletesection","moodle",n),s=M.util.get_string("deletesectionconfirm","theme_charteredcollege"),t=M.util.get_string("cancel","moodle");f.confirm(q,r,s,t,o)},I=function(g,e){g.preventDefault();var j=a(a(e).parents(".charteredcollege-asset")[0]),k=+j[0].id.replace("module-",""),l=j.find(".instancename").text().trim(),m=a(e).data("action"),n="",o="",q="",t="",u="asset_"+m;if(p.ajaxing(u)){return}var v=function(){if(!p.start(u,j,".charteredcollege-edit-asset-more")){return}c.call([{methodname:"core_course_edit_module",args:{action:m,sectionreturn:0,id:k}}],!0,!0)[0].done(function(c){h.ifErrorShowBestMsg(c,q,t).done(function(d){p.complete(u);if(d){b.debug("Ajax request fail")}else{b.debug("Ajax request successful");r=null;s=null;if("delete"===m){j.remove();a("#toc-searchables li[data-id=\""+k+"\"]").remove()}else if("show"===m){j.removeClass("draft")}else if("hide"===m){j.addClass("draft")}else if("duplicate"===m){j.replaceWith(c)}}})}).fail(function(a){h.ifErrorShowBestMsg(a,q,t).done(function(){p.complete(u)})}).always(function(){i.hideAndReset()})},w=function(){if("duplicate"===m){n="action:duplicateasset";o="error:failedtoduplicateasset"}else if("show"===m||"hide"===m){n="action:changeassetvisibility";o="error:failedtochangeassetvisibility"}else if("delete"===m){n="action:deleteasset";o="error:failedtodeleteasset"}return d.get_strings([{key:n,component:"theme_charteredcollege"},{key:o,component:"theme_charteredcollege"}])};w().then(function(a){q=a[0];t=a[0];if("delete"===m){var b="",c={type:M.util.get_string("pluginname",j.attr("class").match(/modtype_([^\s]*)/)[1])};if(""!==l){c.name=l;b=M.util.get_string("deletechecktypename","moodle",c)}else{b=M.util.get_string("deletechecktype","moodle",c)}var d=M.util.get_string("confirm","moodle"),e=M.util.get_string("deleteassetconfirm","theme_charteredcollege",c.type),g=M.util.get_string("cancel","moodle");f.confirm(d,b,e,g,v)}else{v()}})},J=function(c){var d={};b.debug("Move objects",m);d.class="resource";w();n=m.shift();d.id=+n.id.replace("module-","");if(c&&!a(c).hasClass("charteredcollege-drop")){d.beforeId=+a(c)[0].id.replace("module-","")}else{d.beforeId=0}if("page-site-index"===document.body.id){d.sectionId=1}else{if(c){d.sectionId=v(c)}else{d.sectionId=v(n)}}if(0<m.length){C(d,function(){a(c).before(a(n));J(c)},!1)}else{C(d,function(){a(c).before(a(n))},!0)}},K=function(b){var d=v(b),f=k(m[0]),g=f<d?d-1:d;C({class:"section",id:f,value:g},function(){c.call([{methodname:"theme_charteredcollege_course_toc_chapters",args:{courseshortname:j.courseConfig.shortname},done:function done(b){e.render("theme_charteredcollege/course_toc_chapters",b.chapters).done(function(b){a("#chapters").replaceWith(b);a("#section-"+d).before(a("#section-"+f));G(f,g,[],null);location.hash="section-"+g;j.showSection();z()})},fail:function fail(a){h.ifErrorShowBestMsg(a);z()}}],!0,!0)},!0)},L=function(){var b=".charteredcollege-asset-actions .js_charteredcollege_hide, ";b+=".charteredcollege-asset-actions .js_charteredcollege_show, ";b+=".charteredcollege-asset-actions .js_charteredcollege_delete, ";b+=".charteredcollege-asset-actions .js_charteredcollege_duplicate";a(document).on("click",b,function(a){I(a,this)})},N=function(b,d){a("#region-main").on("click",".charteredcollege-section-editing.actions .charteredcollege-"+b,function(f){f.stopPropagation();f.preventDefault();var g=this,i=function(a){this.message="Invalid section action: "+a;this.name="invalidActionException"};if(-1===["visibility","highlight"].indexOf(b)){throw new i(b)}if(!p.start("section_"+b,g)){return}var k,m=!0;if("visibility"===b){k=a(this).hasClass("charteredcollege-hide")?0:1;if(r&&0<r.length&&s&&0<s.length){m=!1}}else{k="true"===a(this).attr("aria-pressed")?0:1}var n=v(this),o="#section-"+n+" .charteredcollege-section-editing"+" .charteredcollege-"+b,q=c.call([{methodname:"theme_charteredcollege_course_sections",args:{courseshortname:j.courseConfig.shortname,action:b,sectionnumber:n,value:k,loadmodules:m}}],!0,!0);q[0].fail(function(a){var c,d;if("visibility"===b){c=M.util.get_string("error:failedtochangesectionvisibility","theme_charteredcollege");d=M.util.get_string("action:changesectionvisibility","theme_charteredcollege")}else{c=M.util.get_string("error:failedtohighlightsection","theme_charteredcollege");d=M.util.get_string("action:highlightsectionvisibility","theme_charteredcollege")}h.ifErrorShowBestMsg(a,d,c).done(function(){p.complete("section_"+b)})}).always(function(){a(g).removeClass("ajaxing")}).done(function(c){return e.render("theme_charteredcollege/course_action_section",c.actionmodel).then(function(b){a(o).replaceWith(b);a(o).focus();if(!m){if(r&&0<r.length&&0===c.toc.modules.length){c.toc.modules=r}if(s&&0<s.length){var d=s.slice(0);a.each(c.toc.chapters.chapters,function(a){c.toc.chapters.chapters[a].progress=d.shift()})}}if(m){r=c.toc.modules;s=[];a.each(c.toc.chapters.chapters,function(a,b){s.push(b.progress)})}return e.render("theme_charteredcollege/course_toc",c.toc)}).then(function(c){a("#course-toc").html(a(c).html());a(document).trigger("charteredcollegeTOCReplaced");if(d&&"function"==typeof d){var e=d(n,k);if(l.courseConfig.partialrender){if("function"==typeof d){p.complete("section_"+b)}}else{if(e&&"function"==typeof e.always){e.always(function(){p.complete("section_"+b)})}else{p.complete("section_"+b)}}}else{p.complete("section_"+b)}})})})},O=function(){N("highlight",function(b){a("#section-"+b).toggleClass("current");var c=a("li.section.main").not("#section-"+b).not("#section-0").removeClass("current");c.each(function(){var b=a(this).find(".charteredcollege-highlight"),c=v(b),d=a(b).attr("href").replace(/(marker=)[0-9]+/ig,"$1"+c);a(b).attr("href",d).attr("aria-pressed","false")})})},P=function(){a(document).on("click",".charteredcollege-section-editing.actions .charteredcollege-delete",function(a){H(a,this)})},Q=function(){N("visibility",function manageHiddenClass(b,c){if(0===c){a("#section-"+b).addClass("hidden")}else{a("#section-"+b).removeClass("hidden");a("#section-"+b+" .charteredcollege-activity .charteredcollege-stealth-tag").remove();a("#section-"+b+" .charteredcollege-activity").removeClass("stealth")}var d=["#section-"+(b-1),"#section-"+(b+1)].join(",");return E(d)})},R=function(){i.show(function(a){a.preventDefault();z()})},S=function(){a("#region-main").on("click",".charteredcollege-section-editing.actions .charteredcollege-move",function(c){c.stopPropagation();c.preventDefault();a("body").addClass("charteredcollege-move-inprogress");R();var d=v(this);b.debug("Section is",d);var e=a("#section-"+d),f=e.find(".sectionname").text();b.debug("Moving this section",f);m=[e];a(".section-moving").removeClass("section-moving");e.addClass("section-moving");a("a[href=\"#section-"+d+"\"]").parent("li").addClass("section-moving");a("body").addClass("charteredcollege-move-section");if(l.courseConfig.partialrender){a("#section-"+(d+1)+" .charteredcollege-drop.section-drop").removeClass("partial-render")}var g=M.util.get_string("moving","theme_charteredcollege",f);i.setTitle(g);x(f)})},T=function(){if("page-site-index"===document.body.id){a("#region-main .sitetopic ul.section").append("<li class=\"charteredcollege-drop asset-drop\"><div class=\"asset-wrapper\"><a href=\"#\">"+M.util.get_string("movehere","theme_charteredcollege")+"</a></div></li>")}else{a("li.section .content ul.section").append("<li class=\"charteredcollege-drop asset-drop\"><div class=\"asset-wrapper\"><a href=\"#\">"+M.util.get_string("movehere","theme_charteredcollege")+"</a></div></li>")}},U=function(){a("#region-main").on("change",".js-charteredcollege-asset-move",function(c){c.stopPropagation();var d=a(this).parents(".charteredcollege-asset")[0],e=a(d).parents("ul.section")[0],f=a(e).find("li.charteredcollege-drop.asset-drop");a(e).append(f);if(0===m.length){var g=a(d).find(".charteredcollege-asset-link .instancename").html();b.debug("Moving this asset",g);var h=a(d).attr("class"),i=/(?=charteredcollege-mime)([a-z0-9\-]*)/,j=i.exec(h);h="";if(j){h=j.join(" ")}b.debug("Moving this class",h);a(d).addClass("asset-moving");a(".charteredcollege-asset button").attr("disabled","disabled");a(d).find("button").removeAttr("disabled");a(".charteredcollege-asset .charteredcollege-asset-content a").attr("tabindex","-1");a(d).find("a").removeAttr("tabindex");a(d).find(".js-charteredcollege-asset-move").prop("checked","checked");a("body").addClass("charteredcollege-move-inprogress");a("body").addClass("charteredcollege-move-asset")}if(a(this).prop("checked")){m.push(d);a(d).find("a").removeAttr("tabindex");a(d).find("button").removeAttr("disabled");a(d).addClass("asset-moving")}else{B(d);a(d).find(".charteredcollege-asset-content a").attr("tabindex","-1");a(d).find("button").attr("disabled","disabled");a(d).removeClass("asset-moving");if(0===m.length){z()}}R();w()})},V=function(){a(document).on("click",".charteredcollege-move-note, .charteredcollege-drop",function(c){b.debug("charteredcollege drop clicked",c);if(m){c.stopPropagation();c.preventDefault();if(a("body").hasClass("charteredcollege-move-section")){K(this)}else{var d;if(a(this).hasClass("charteredcollege-drop")){d=this}else{d=a(this).closest(".charteredcollege-asset")}J(d)}}})},W=function(){t();u()},X=function(){S();Q();O();P();U();V();L();T();if(j.courseConfig.partialrender){W()}a("body").addClass("charteredcollege-course-listening")},Y=function(){if(M.course&&M.course.resource_toolbox){M.course.resource_toolbox.handle_resource_dim=function(a,b,c){return"hide"===c?0:1}}},Z=function(){if(0===a(".charteredcollege-section-editing.actions").length){return}var b=a("#region-main");if(!p.start("section_toc",b)){return}var d=c.call([{methodname:"theme_charteredcollege_course_sections",args:{courseshortname:j.courseConfig.shortname,action:"toc",sectionnumber:0,value:0,loadmodules:0}}],!0,!0);d[0].fail(function(a){var b,c;b=M.util.get_string("error:failedtotoc","theme_charteredcollege");c=M.util.get_string("action:sectiontoc","theme_charteredcollege");h.ifErrorShowBestMsg(a,c,b).done(function(){p.complete("section_toc")})}).always(function(){a(b).removeClass("ajaxing")}).done(function(b){r=b.toc.modules;s=[];a.each(b.toc.chapters.chapters,function(a,b){s.push(b.progress)});p.complete("section_toc")})};(function initialise(){X();Z();g.whenTrue(function(){return M.course&&M.course.init_section_toolbox},function(){Y()},!0)})()},renderAndFocusSection:function renderAndFocusSection(a,b){y(a,b)},setTocObserver:function setTocObserver(){t()}}});
//# sourceMappingURL=section_asset_management.min.js.map
